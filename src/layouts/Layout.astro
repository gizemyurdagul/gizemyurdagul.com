---
interface Props {
	title?: string;
}

const { title = 'Gizem Yurdag√ºl - Personal Website' } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>{title}</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
	</head>
	<body>
		<slot />
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const themeToggle = document.getElementById('theme-toggle');
				const navLinks = document.querySelectorAll('.nav-link');
				const activeIndicator = document.querySelector('.active-indicator');
				const navList = document.querySelector('.nav-links');

				function applySavedTheme() {
					const savedTheme = localStorage.getItem('theme');
					if (savedTheme === 'dark') {
						document.body.classList.add('dark-mode');
					}
				}

				applySavedTheme();

				themeToggle?.addEventListener('click', () => {
					document.body.classList.toggle('dark-mode');
					const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
					localStorage.setItem('theme', theme);
				});

				if (navLinks.length === 0 || !activeIndicator || !navList) return;

				const animationDuration = 100;
				let isTransitioning = false;
				let currentPageId = 'about';

				function moveIndicator() {
					const activeLink = document.querySelector('.nav-link.active');
					if (!activeLink) return;

					const linkRect = activeLink.getBoundingClientRect();
					const navListRect = navList.getBoundingClientRect();

					(activeIndicator as HTMLElement).style.width = `${linkRect.width}px`;
					(activeIndicator as HTMLElement).style.left = `${linkRect.left - navListRect.left}px`;
				}

				function switchPage(targetPageId: string) {
					if (isTransitioning || targetPageId === currentPageId) return;

					isTransitioning = true;
					const currentPage = document.querySelector(`section[id="${currentPageId}-content"]`);
					const targetPage = document.querySelector(`section[id="${targetPageId}-content"]`);

					if (currentPage) {
						currentPage.classList.add('fade-out');
					}

					setTimeout(() => {
						if (currentPage) {
							currentPage.classList.add('hidden');
							currentPage.classList.remove('fade-out');
						}

						if (targetPage) {
							targetPage.classList.remove('hidden');
							targetPage.classList.add('fade-in');
						}
						currentPageId = targetPageId;

						setTimeout(() => {
							if (targetPage) {
								targetPage.classList.remove('fade-in');
							}
							isTransitioning = false;
						}, animationDuration);

					}, animationDuration);
				}

				navLinks.forEach(link => {
					link.addEventListener('click', (e) => {
						e.preventDefault();
						if (link.classList.contains('active') || isTransitioning) return;

						navLinks.forEach(l => l.classList.remove('active'));
						link.classList.add('active');

						moveIndicator();

						const page = link.getAttribute('data-page');
						if (page) {
							sessionStorage.setItem('source', page);
							switchPage(page);
						}
					});
				});

				function initializePage() {
					const refPage = sessionStorage.getItem('source');
					if (refPage) {
						const refLink = document.querySelector(`[data-page="${refPage}"]`);
						navLinks.forEach(l => l.classList.remove('active'));
						refLink?.classList.add('active');
					}

					const activeLink = document.querySelector('.nav-link.active');
					if (activeLink) {
						currentPageId = activeLink.getAttribute('data-page') || 'about';
					}

					document.querySelectorAll('.page-content').forEach(page => {
						if (page.id !== `${currentPageId}-content`) {
							page.classList.add('hidden');
						} else {
							page.classList.remove('hidden');
						}
					});

					moveIndicator();
				}

				initializePage();
				window.addEventListener('resize', moveIndicator);
			});
		</script>
	</body>
</html>

<style is:global>
	@import '../styles/global.css';
</style>
