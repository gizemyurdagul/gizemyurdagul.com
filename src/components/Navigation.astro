---
import BackButton from "./BackButton.astro";
import ThemeToggleButton from "./ThemeToggleButton.astro";

const { pathname } = Astro.url;
const pathSegments = pathname.split('/').filter(Boolean); // e.g., /blog/post -> ['blog', 'post']

const isSubPage = pathSegments.length > 1;
const parentPath = isSubPage ? `/${pathSegments[0]}` : "";
const parentTitle = isSubPage ? pathSegments[0].charAt(0).toUpperCase() + pathSegments[0].slice(1) : "";

const navLinks = [
    { href: "/", label: "Home" },
    { href: "/blog", label: "Blog" },
    { href: "/projects", label: "Projects" },
];
---

<header class="navbar">
	<div class="nav-container">
		{isSubPage ? (
		    <BackButton parentPath={parentPath} />
				<ul class="nav-links">
				  <div class="active-indicator"></div>
                    <li><a class="nav-link active">{parentTitle}</a></li>
        </ul>
				<ThemeToggleButton />
		) : (
			<>
				<ul class="nav-links">
					<div class="active-indicator"></div>
					{navLinks.map(link => (
						<li><a class=`nav-link ${pathname === link.href ? 'active' : ''}` href={link.href}>{link.label}</a></li>
					))}
				</ul>
				<ThemeToggleButton />
			</>
		)}
	</div>
</header>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const navLinks = document.querySelectorAll(".nav-link");
    const activeIndicator = document.querySelector(".active-indicator");
    const navList = document.querySelector(".nav-links");

    if (navLinks.length === 0 || !activeIndicator || !navList) return;

    function moveIndicator() {
      const activeLink = document.querySelector(".nav-link.active");
      if (!activeLink) return;

      const linkRect = activeLink.getBoundingClientRect();
      const navListRect = navList.getBoundingClientRect();

      (activeIndicator as HTMLElement).style.width = `${linkRect.width}px`;
      (activeIndicator as HTMLElement).style.left =
        `${linkRect.left - navListRect.left}px`;
    }

    // Position the indicator immediately on page load without animation.
    moveIndicator();

    // Enable transitions only after the initial positioning is done.
    // A small timeout ensures the browser applies the initial styles before adding the transition.
    setTimeout(() => {
      activeIndicator.classList.add("transition-enabled");
    }, 10);

    window.addEventListener("resize", moveIndicator);
  });
</script>

